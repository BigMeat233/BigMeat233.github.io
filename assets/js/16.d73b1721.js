(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{341:function(t,s,a){"use strict";a.r(s);var n=a(33),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"日志输出组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志输出组"}},[t._v("#")]),t._v(" 日志输出组")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("说明")]),t._v(" "),a("p",[t._v("本章中使用的宏变量存储在"),a("code",[t._v("Core.Macros")]),t._v("中。")])]),t._v(" "),a("p",[a("strong",[t._v("日志输出组")]),t._v("提供了将一个或多个"),a("a",{attrs:{href:"/guide/logger-introduce"}},[t._v("日志输出器")]),t._v("进行组合的能力。在本章中，我们将讨论"),a("strong",[t._v("日志输出组")]),t._v("的使用方式。")]),t._v(" "),a("p",[t._v("我们已经知道，"),a("strong",[t._v("日志输出组")]),t._v("无法通过实例化直接创建实例，而是依赖"),a("a",{attrs:{href:"#loggercore"}},[t._v("LoggerCore")]),t._v("执行"),a("code",[t._v("createGroupLogger()")]),t._v("间接执行实例化。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("说明")]),t._v(" "),a("p",[t._v("在设计上，"),a("strong",[t._v("日志输出组")]),t._v("使用了典型的工厂模式，即"),a("a",{attrs:{href:"#loggercore"}},[t._v("LoggerCore")]),t._v("是生产"),a("strong",[t._v("日志输出组")]),t._v("的工厂。")]),t._v(" "),a("p",[t._v("因此，我们在使用"),a("strong",[t._v("日志输出组")]),t._v("进行组合日志输出需要：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("将需要组合的"),a("a",{attrs:{href:"/guide/logger-introduce"}},[t._v("日志输出器")]),t._v("组成"),a("strong",[t._v("LoggerCore")]),t._v("的配置参数创建"),a("strong",[t._v("LoggerCore")]),t._v("实例。")])]),t._v(" "),a("li",[a("p",[t._v("使用"),a("strong",[t._v("LoggerCore")]),t._v("实例执行"),a("code",[t._v("createGroupLogger()")]),t._v("并传入期望的"),a("strong",[t._v("日志输出组")]),t._v("类型和配置参数，即可得到对应的"),a("strong",[t._v("日志输出组")]),t._v("实例。")])])])]),t._v(" "),a("h2",{attrs:{id:"行为控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#行为控制"}},[t._v("#")]),t._v(" 行为控制")]),t._v(" "),a("p",[t._v("在引入了"),a("a",{attrs:{href:"#loggercore"}},[t._v("LoggerCore")]),t._v("和"),a("strong",[t._v("日志输出组")]),t._v("后，我们无法直接触发"),a("strong",[t._v("日志输出组")]),t._v("组合的"),a("a",{attrs:{href:"/guide/logger-introduce"}},[t._v("日志输出器")]),t._v("的构建、启动和关闭动作。而是在实例化"),a("a",{attrs:{href:"#loggercore"}},[t._v("LoggerCore")]),t._v("使用的配置参数中指定这些动作的触发方式，使"),a("strong",[t._v("LoggerCore")]),t._v("和"),a("strong",[t._v("日志输出组")]),t._v("在恰当的时间点自动执行这些动作以满足日志收集的场景。")]),t._v(" "),a("h3",{attrs:{id:"输出器构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#输出器构建"}},[t._v("#")]),t._v(" 输出器构建")]),t._v(" "),a("p",[t._v("我们在"),a("a",{attrs:{href:"#loggercore"}},[t._v("LoggerCore")]),t._v("构建时的配置参数中指定每个"),a("a",{attrs:{href:"/guide/logger-introduce"}},[t._v("日志输出器")]),t._v("的"),a("code",[t._v("buildTrigger")]),t._v("以控制何时创建这些"),a("strong",[t._v("日志输出器")]),t._v("的实例：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[a("code",[t._v("init")])]),t._v("：在"),a("strong",[t._v("LoggerCore")]),t._v("实例化时触发"),a("strong",[t._v("日志输出器")]),t._v("的构建动作。通常，持续型输出器使用此方式触发构建，比如："),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#日期输出器"}},[t._v("日期输出器")]),t._v("。")],1)]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("create")])]),t._v("：在"),a("strong",[t._v("日志输出组")]),t._v("实例化时触发"),a("strong",[t._v("日志输出器")]),t._v("的构建动作，即："),a("strong",[t._v("LoggerCore")]),t._v("实例执行"),a("code",[t._v("createGroupLogger()")]),t._v("时。通常，临时型输出器使用此方式触发构建，比如："),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#文件输出器"}},[t._v("文件输出器")]),t._v("。")],1)])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("原则上，"),a("strong",[t._v("LoggerCore")]),t._v("实例化动作仅执行一次。因此，我们可以将期望被"),a("strong",[t._v("LoggerCore")]),t._v("创建的所有"),a("strong",[t._v("日志输出组")]),t._v("实例共享的"),a("strong",[t._v("日志输出器")]),t._v("使用"),a("code",[t._v("init")]),t._v("方式触发构建。")]),t._v(" "),a("p",[t._v("比如对一些频次型业务产生的日志进行收集时，我们可能希望将每次业务执行时的基础信息通过相同的"),a("strong",[t._v("日志输出器")]),t._v("进行收集，而每次业务执行链路产生的日志使用不同的"),a("strong",[t._v("日志输出器")]),t._v("收集。此时，我们可以：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("指定"),a("strong",[t._v("日志输出组")]),t._v("共享的"),a("strong",[t._v("日志输出器")]),t._v("使用"),a("code",[t._v("init")]),t._v("方式触发构建。")])]),t._v(" "),a("li",[a("p",[t._v("指定"),a("strong",[t._v("日志输出组")]),t._v("非共享的"),a("strong",[t._v("日志输出器")]),t._v("使用"),a("code",[t._v("create")]),t._v("方式触发构建。")])]),t._v(" "),a("li",[a("p",[t._v("每次业务执行时，使用"),a("strong",[t._v("LoggerCore")]),t._v("实例执行"),a("code",[t._v("createGroupLogger()")]),t._v("创建新的"),a("strong",[t._v("日志输出组")]),t._v("实例用于链路中的日志收集。")])])])]),t._v(" "),a("h3",{attrs:{id:"输出器启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#输出器启动"}},[t._v("#")]),t._v(" 输出器启动")]),t._v(" "),a("p",[t._v("同样，我们可以在"),a("a",{attrs:{href:"#loggercore"}},[t._v("LoggerCore")]),t._v("构建时的配置参数中指定每个"),a("a",{attrs:{href:"/guide/logger-introduce"}},[t._v("日志输出器")]),t._v("的"),a("code",[t._v("startTrigger")]),t._v("以控制何时启动这些"),a("strong",[t._v("日志输出器")]),t._v("的实例：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[a("code",[t._v("none")])]),t._v("："),a("strong",[t._v("LoggerCore")]),t._v("和"),a("strong",[t._v("日志输出组")]),t._v("不执"),a("strong",[t._v("日志输出器")]),t._v("的启动动作。通常，支持自动启动的输出器使用此方式触发启动，比如："),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#日期输出器"}},[t._v("日期输出器")]),t._v("、自动模式下的"),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#文件输出器"}},[t._v("文件输出器")]),t._v("。")],1)]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("normal")])]),t._v("：在"),a("strong",[t._v("日志输出组")]),t._v("实例执行"),a("code",[t._v("start()")]),t._v("时触发"),a("strong",[t._v("日志输出器")]),t._v("的启动动作，即："),a("strong",[t._v("日志输出器")]),t._v("伴随"),a("strong",[t._v("日志输出组")]),t._v("启动。通常，不支持自动启动的输出器使用此方式触发启动，比如：手动模式下的"),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#文件输出器"}},[t._v("文件输出器")]),t._v("。")],1)])]),t._v(" "),a("h3",{attrs:{id:"输出器关闭"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#输出器关闭"}},[t._v("#")]),t._v(" 输出器关闭")]),t._v(" "),a("p",[t._v("同样，我们可以在"),a("a",{attrs:{href:"#loggercore"}},[t._v("LoggerCore")]),t._v("构建时的配置参数中指定每个"),a("a",{attrs:{href:"/guide/logger-introduce"}},[t._v("日志输出器")]),t._v("的"),a("code",[t._v("closeTrigger")]),t._v("以控制何时关闭这些"),a("strong",[t._v("日志输出器")]),t._v("的实例：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[a("code",[t._v("none")])]),t._v("："),a("strong",[t._v("LoggerCore")]),t._v("和"),a("strong",[t._v("日志输出组")]),t._v("不执"),a("strong",[t._v("日志输出器")]),t._v("的关闭动作。通常，支持自动关闭的输出器使用此方式触发关闭，比如：自动模式下的"),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#文件输出器"}},[t._v("文件输出器")]),t._v("。")],1)]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("normal")])]),t._v("：在"),a("strong",[t._v("日志输出组")]),t._v("实例执行"),a("code",[t._v("close()")]),t._v("时触发"),a("strong",[t._v("日志输出器")]),t._v("的关闭动作，即："),a("strong",[t._v("日志输出器")]),t._v("伴随"),a("strong",[t._v("日志输出组")]),t._v("关闭。通常，不支持自动关闭的输出器使用此方式触发关闭，比如："),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#日期输出器"}},[t._v("日期输出器")]),t._v("、手动模式下的"),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#文件输出器"}},[t._v("文件输出器")]),t._v("。")],1)])]),t._v(" "),a("h2",{attrs:{id:"loggercore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#loggercore"}},[t._v("#")]),t._v(" LoggerCore")]),t._v(" "),a("p",[t._v("我们已经知道，"),a("strong",[t._v("LoggerCore")]),t._v("是生产"),a("strong",[t._v("日志输出组")]),t._v("的工厂。")]),t._v(" "),a("p",[t._v("通常，我们把"),a("strong",[t._v("LoggerCore")]),t._v("实例在相同的日志收集场景中共享。在业务执行时，使用"),a("code",[t._v("createGroupLogger()")]),t._v("创建"),a("strong",[t._v("日志输出组")]),t._v("实例用于跟踪业务链路中产生的日志。")]),t._v(" "),a("hr"),t._v(" "),a("p",[a("strong",[t._v("LoggerCore")]),t._v("实例创建"),a("strong",[t._v("日志输出组")]),t._v("实例实际上执行了两个动作：")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("LoggerCore")]),t._v("实例根据实例化时应用的配置参数，创建需要组合的"),a("a",{attrs:{href:"/guide/logger-introduce"}},[t._v("日志输出器")]),t._v("实例并组成待植入"),a("strong",[t._v("日志输出组")]),t._v("实例的"),a("strong",[t._v("日志输出器实例列表")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("实例化"),a("code",[t._v("createGroupLogger()")]),t._v("指定的"),a("strong",[t._v("日志输出组")]),t._v("，得到对应的"),a("strong",[t._v("日志输出组")]),t._v("实例。"),a("strong",[t._v("日志输出组")]),t._v("实例化时会应用①中构造的"),a("strong",[t._v("日志输出器实例列表")]),t._v("。")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("说明")]),t._v(" "),a("p",[a("strong",[t._v("日志输出器实例列表")]),t._v("中的元素其实并不仅仅是"),a("strong",[t._v("日志输出器")]),t._v("实例本身，而是一个包含了"),a("strong",[t._v("日志输出器")]),t._v("的行为触发方式的"),a("code",[t._v("Object")]),t._v("，其结构为：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[a("code",[t._v("logger")])]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("实例。")])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("startTrigger")])]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("的启动触发方式。")])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("closeTrigger")])]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("的关闭触发方式。")])])]),t._v(" "),a("p",[a("strong",[t._v("日志输出组")]),t._v("将根据"),a("strong",[t._v("行为触发方式")]),t._v("在恰当的时间点执行"),a("strong",[t._v("日志输出器")]),t._v("实例的相关动作。")])]),t._v(" "),a("h3",{attrs:{id:"配置说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置说明"}},[t._v("#")]),t._v(" 配置说明")]),t._v(" "),a("p",[t._v("通常，实例化"),a("strong",[t._v("LoggerCore")]),t._v("需要使用由"),a("strong",[t._v("标识ID")]),t._v("、"),a("strong",[t._v("输出器基础配置")]),t._v("和"),a("strong",[t._v("输出器配置列表")]),t._v("构成的配置对象，即："),a("code",[t._v("{ id, env, level, params, loggers }")]),t._v("。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("id")]),t._v("："),a("strong",[t._v("LoggerCore")]),t._v("的唯一标识，默认值为"),a("code",[t._v("`LoggerCore_${generateRandomString(6, 'uln')}`")]),t._v("。")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("我们可以通过在应用程序中使用唯一的"),a("code",[t._v("id")]),t._v("标识和存储"),a("strong",[t._v("LoggerCore")]),t._v("实例以实现在相同日志收集场景中共享"),a("strong",[t._v("LoggerCore")]),t._v("实例。")])]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("env")]),t._v("："),a("strong",[t._v("LoggerCore")]),t._v("的运行环境/"),a("strong",[t._v("日志输出器")]),t._v("的基础运行环境，默认值为"),a("code",[t._v("BASE_LOGGER_DEVELOPMENT_ENVIRONMENT")]),t._v("。")]),t._v(" "),a("p",[t._v("需要注意的是，"),a("strong",[t._v("运行环境")]),t._v("将影响"),a("strong",[t._v("LoggerCore")]),t._v("的行为：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("当运行环境为"),a("code",[t._v("BASE_LOGGER_DEVELOPMENT_ENVIRONMENT")]),t._v("时，"),a("strong",[t._v("LoggerCore")]),t._v("创建"),a("strong",[t._v("日志输出器")]),t._v("实例时将忽略配置对象中指定的"),a("strong",[t._v("输出器配置列表")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("当运行环境不为"),a("code",[t._v("BASE_LOGGER_DEVELOPMENT_ENVIRONMENT")]),t._v("时，"),a("strong",[t._v("LoggerCore")]),t._v("创建"),a("strong",[t._v("日志输出器")]),t._v("实例时将应用配置对象中实际指定的"),a("strong",[t._v("输出器配置列表")]),t._v("。")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("说明")]),t._v(" "),a("p",[t._v("当运行环境为"),a("code",[t._v("BASE_LOGGER_DEVELOPMENT_ENVIRONMENT")]),t._v("时，"),a("strong",[t._v("LoggerCore")]),t._v("将不再使用配置对象中指定的"),a("strong",[t._v("输出器配置列表")]),t._v("创建"),a("strong",[t._v("日志输出器")]),t._v("实例，而是使用一个"),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#基础输出器"}},[t._v("基础输出器")]),t._v("将日志单点输出至控制台，其触发方式为：")],1),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("构建触发方式")]),t._v("："),a("code",[t._v("init")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("启动触发方式")]),t._v("："),a("code",[t._v("none")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("关闭触发方式")]),t._v("："),a("code",[t._v("none")]),t._v("。")])])])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("另外，此配置将作为在"),a("strong",[t._v("输出器配置列表")]),t._v("中指定"),a("strong",[t._v("日志输出器")]),t._v("运行环境"),a("code",[t._v("env")]),t._v("时的默认值：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("未指定"),a("strong",[t._v("日志输出器")]),t._v("的"),a("code",[t._v("env")]),t._v("时，使用此配置。")])]),t._v(" "),a("li",[a("p",[t._v("指定了"),a("strong",[t._v("日志输出器")]),t._v("的"),a("code",[t._v("env")]),t._v("时，使用实际配置。")])])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("level")]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("的基础最小日志输出等级的名称或别名。")]),t._v(" "),a("p",[t._v("与"),a("a",{attrs:{href:"/guide/logger-introduce"}},[t._v("日志输出器")]),t._v("相同，此配置的默认值依赖于当前"),a("strong",[t._v("LoggerCore")]),t._v("的"),a("strong",[t._v("运行环境")]),t._v("：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("当运行环境为"),a("code",[t._v("BASE_LOGGER_DEVELOPMENT_ENVIRONMENT")]),t._v("时，默认值为："),a("code",[t._v("all")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("当运行环境不为"),a("code",[t._v("BASE_LOGGER_DEVELOPMENT_ENVIRONMENT")]),t._v("时，默认值为："),a("code",[t._v("error")]),t._v("。")])])]),t._v(" "),a("p",[t._v("此配置的意义在于，将作为在"),a("strong",[t._v("输出器配置列表")]),t._v("中指定"),a("strong",[t._v("日志输出器")]),t._v("最小日志输出等级"),a("code",[t._v("level")]),t._v("时的默认值：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("未指定"),a("strong",[t._v("日志输出器")]),t._v("的"),a("code",[t._v("level")]),t._v("时，使用此配置。")])]),t._v(" "),a("li",[a("p",[t._v("指定了"),a("strong",[t._v("日志输出器")]),t._v("的"),a("code",[t._v("level")]),t._v("时，使用实际配置。")])])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("params")]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("的基础功能配置参数。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("loggers")]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("的配置列表，其元素结构为："),a("code",[t._v("{ type, buildTrigger, startTrigger, closeTrigger, env, level, params }")]),t._v("。")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("type")]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("的类型，可以使用Corejs内置的"),a("strong",[t._v("日志输出器")]),t._v("或"),a("RouterLink",{attrs:{to:"/guide/logger-customizing.html"}},[t._v("自定义输出器")]),t._v("，默认值为"),a("code",[t._v("null")]),t._v("。")],1),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[a("strong",[t._v("LoggerCore")]),t._v("创建"),a("strong",[t._v("日志输出器")]),t._v("实例时将对使用的"),a("code",[t._v("type")]),t._v("进行校验。如果指定了未继承自"),a("code",[t._v("Core.BaseLogger")]),t._v("的"),a("strong",[t._v("自定义输出器")]),t._v("时，将认为"),a("strong",[t._v("日志输出器")]),t._v("的类型无效，不再执行实际构建动作。")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("buildTrigger")]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("的"),a("strong",[t._v("构建触发方式")]),t._v("，默认值为"),a("code",[t._v("'init'")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("startTrigger")]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("的"),a("strong",[t._v("启动触发方式")]),t._v("，默认值为"),a("code",[t._v("'none'")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("closeTrigger")]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("的"),a("strong",[t._v("关闭触发方式")]),t._v("，默认值为"),a("code",[t._v("'none'")]),t._v("。")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("关于"),a("strong",[t._v("日志输出器")]),t._v("的行为触发方式，我们可以参考"),a("a",{attrs:{href:"#%E8%A1%8C%E4%B8%BA%E6%8E%A7%E5%88%B6"}},[t._v("行为控制")]),t._v("一节。")])]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("env")]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("的"),a("strong",[t._v("运行环境")]),t._v("，默认值为"),a("strong",[t._v("LoggerCore")]),t._v("的"),a("strong",[t._v("运行环境")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("level")]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("最小日志输出等级的名称或别名，默认值为"),a("strong",[t._v("LoggerCore")]),t._v("的最小日志输出等级名称或别名。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("params")]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("的功能配置参数。")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("关于"),a("strong",[t._v("日志输出器")]),t._v("的"),a("strong",[t._v("运行环境")]),t._v("、"),a("strong",[t._v("最小输出等级")]),t._v("和"),a("strong",[t._v("功能配置参数")]),t._v("，我们可以参考"),a("strong",[t._v("日志输出器")]),t._v("的"),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#输出器配置"}},[t._v("功能配置")]),t._v("一节。")],1)])])]),t._v(" "),a("h3",{attrs:{id:"配置参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置参数"}},[t._v("#")]),t._v(" 配置参数")]),t._v(" "),a("p",[t._v("在"),a("strong",[t._v("LoggerCore")]),t._v("创建"),a("strong",[t._v("日志输出器")]),t._v("实例时，应用的"),a("strong",[t._v("配置参数")]),t._v("通过将"),a("strong",[t._v("个性化配置参数")]),t._v("合并至"),a("strong",[t._v("默认配置参数")]),t._v("生成：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("个性化配置参数")]),t._v("即是在"),a("strong",[t._v("输出器配置列表")]),t._v("对"),a("strong",[t._v("日志输出器")]),t._v("指定的"),a("strong",[t._v("配置参数")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("默认配置参数")]),t._v("可能由以下两个部分组成：")]),t._v(" "),a("ol",[a("li",[a("p",[a("strong",[t._v("LoggerCore")]),t._v("实例化时指定的"),a("code",[t._v("env")]),t._v("、"),a("code",[t._v("level")]),t._v("和"),a("code",[t._v("params")]),t._v("组成的"),a("strong",[t._v("配置参数")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("LoggerCore")]),t._v("实例执行"),a("code",[t._v("createGroupLogger()")]),t._v("时传入的"),a("strong",[t._v("配置参数")]),t._v("。")])])])])]),t._v(" "),a("h4",{attrs:{id:"默认配置参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#默认配置参数"}},[t._v("#")]),t._v(" 默认配置参数")]),t._v(" "),a("hr"),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("使用"),a("code",[t._v("init")]),t._v("触发创建行为的日志输出器")]),t._v("，其实例化时使用的"),a("strong",[t._v("默认配置参数")]),t._v("将仅由"),a("strong",[t._v("LoggerCore")]),t._v("实例化时指定的"),a("code",[t._v("env")]),t._v("、"),a("code",[t._v("level")]),t._v("和"),a("code",[t._v("params")]),t._v("组成。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("使用"),a("code",[t._v("create")]),t._v("触发创建行为的日志输出器")]),t._v("，对于其使用的"),a("strong",[t._v("默认配置参数")]),t._v("：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("使用"),a("code",[t._v("Object.assign()")]),t._v("将"),a("code",[t._v("createGroupLogger()")]),t._v("时传入"),a("strong",[t._v("配置参数")]),t._v("的功能配置参数"),a("code",[t._v("params")]),t._v("与"),a("strong",[t._v("LoggerCore")]),t._v("实例化时指定的基础功能配置参数"),a("code",[t._v("params")]),t._v("合并，得到"),a("code",[t._v("{ params }")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("使用"),a("code",[t._v("Object.assign()")]),t._v("将"),a("code",[t._v("createGroupLogger()")]),t._v("时传入"),a("strong",[t._v("配置参数")]),t._v("的"),a("strong",[t._v("运行环境")]),t._v("与"),a("strong",[t._v("最小输出等级")]),t._v("组成"),a("code",[t._v("{ env, level }")]),t._v("并与"),a("strong",[t._v("LoggerCore")]),t._v("实例化时指定"),a("code",[t._v("env")]),t._v("和"),a("code",[t._v("level")]),t._v("合并，得到"),a("code",[t._v("{ env, level }")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("使用"),a("code",[t._v("Object.assign()")]),t._v("合并①和②得到"),a("strong",[t._v("默认配置参数")]),t._v("。")])])])])]),t._v(" "),a("h4",{attrs:{id:"应用配置参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用配置参数"}},[t._v("#")]),t._v(" 应用配置参数")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("在创建"),a("strong",[t._v("日志输出器")]),t._v("实例时，"),a("strong",[t._v("LoggerCore")]),t._v("使用与"),a("a",{attrs:{href:"#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"}},[t._v("默认配置参数")]),t._v("类似的方式合并"),a("strong",[t._v("个性化配置参数")]),t._v("和"),a("strong",[t._v("默认配置参数")]),t._v("生成最终应用于"),a("strong",[t._v("日志输出器")]),t._v("的配置参数。因此，配置参数的优先级顺序从高到低依次为：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("输出器配置列表")]),t._v("中指定的"),a("strong",[t._v("配置参数")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("createGroupLogger()")]),t._v("时指定的"),a("strong",[t._v("配置参数")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("在"),a("strong",[t._v("LoggerCore")]),t._v("实例化参数中指定的"),a("strong",[t._v("配置参数")]),t._v("。")])])]),t._v(" "),a("p",[t._v("在默认的"),a("strong",[t._v("配置参数")]),t._v("应用规则无法满足实际需求时，我们可以修改"),a("strong",[t._v("LoggerCore")]),t._v("实例的"),a("code",[t._v("onBuildLogger")]),t._v("属性以定制"),a("strong",[t._v("日志输出器")]),t._v("的创建行为，具体将在"),a("a",{attrs:{href:"#%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86"}},[t._v("运行原理")]),t._v("一节中讨论。")]),t._v(" "),a("h3",{attrs:{id:"运行原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行原理"}},[t._v("#")]),t._v(" 运行原理")]),t._v(" "),a("p",[t._v("我们已经知道，"),a("strong",[t._v("LoggerCore")]),t._v("实例将在执行"),a("code",[t._v("createGroupLogger()")]),t._v("时创建"),a("strong",[t._v("日志输出组")]),t._v("实例并向其中植入"),a("strong",[t._v("日志输出器实例列表")]),t._v("。于是，小朋友你是否有很多问号：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("日志输出器")]),t._v("实例如何创建？")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("日志输出器")]),t._v("实例何时创建？")])])]),t._v(" "),a("p",[t._v("在本节中，我们将围绕这两个问题讨论"),a("strong",[t._v("LoggerCore")]),t._v("的运行原理。")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("对于"),a("strong",[t._v("日志输出器实例如何创建")]),t._v("，答案非常简单："),a("strong",[t._v("LoggerCore")]),t._v("将在需要创建"),a("strong",[t._v("输出器配置列表")]),t._v("某个"),a("strong",[t._v("日志输出器")]),t._v("时，提取其在"),a("strong",[t._v("输出器配置列表")]),t._v("指定的配置参数并调用实例方法"),a("code",[t._v("onBuildLogger()")]),t._v("。")]),t._v(" "),a("p",[a("code",[t._v("onBuildLogger()")]),t._v("接收三个参数用于创建"),a("strong",[t._v("日志输出器")]),t._v("实例：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[a("code",[t._v("type")])]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("的类型。")])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("loggerConfigs")])]),t._v("：在"),a("strong",[t._v("输出器配置列表")]),t._v("中指定的"),a("strong",[t._v("个性化配置参数")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("defaultConfigs")])]),t._v("："),a("strong",[t._v("LoggerCore")]),t._v("自动应用的"),a("a",{attrs:{href:"#%E9%BB%98%E8%AE%A4%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"}},[t._v("默认配置参数")]),t._v("。")])])]),t._v(" "),a("p",[t._v("举一个🌰，有这样一个"),a("strong",[t._v("LoggerCore")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Core "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node-corejs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" loggerCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LoggerCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  env"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'prod'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  level"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'infos'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" sourcePath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./testlogs'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  loggers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FileLogger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    buildTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'create'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    startTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'normal'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    closeTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'normal'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    level"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" auto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filePrefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'FileLogger_1'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br")])]),a("p",[t._v("在创建"),a("strong",[t._v("日志输出组")]),t._v("时使用了：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("loggerCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createGroupLogger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" level"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'all'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" fileName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'LogFile'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("那么，"),a("strong",[t._v("LoggerCore")]),t._v("调用"),a("code",[t._v("onBuildLogger()")]),t._v("时带入的参数为：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("type "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FileLogger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nloggerConfigs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" level"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" auto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filePrefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'FileLogger_1'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\ndefaultConfigs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" env"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'prod'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" level"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'all'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" sourcePath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./testlogs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fileName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'LogFile'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("接下来，让我们看一看"),a("code",[t._v("onBuildLogger()")]),t._v("的默认合并"),a("strong",[t._v("个性化配置参数")]),t._v("和"),a("strong",[t._v("默认配置参数")]),t._v("的实现：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onBuildLogger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" loggerConfigs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" defaultConfigs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将个性化功能配置合并至默认功能配置")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" params "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("assign")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" defaultConfigs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" loggerConfigs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将个性化配置合并至默认配置并合并功能配置")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" configs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("assign")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" defaultConfigs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" loggerConfigs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" params "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行输出器的实例化")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("configs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("p",[t._v("因此，我们可以通过修改"),a("strong",[t._v("LoggerCore")]),t._v("实例的"),a("code",[t._v("onBuildLogger")]),t._v("属性进行更改以变更默认的"),a("strong",[t._v("日志输出器")]),t._v("创建行为。")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Core "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node-corejs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建LoggerCore实例")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" loggerCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LoggerCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  env"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'prod'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  level"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'infos'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" sourcePath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./testlogs'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  loggers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FileLogger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    buildTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'create'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    startTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'normal'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    closeTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'normal'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    level"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n      auto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n      filePrefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'FileLogger_1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      filePrefixAsFileName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必须在createGroupLogger()前修改onBuildLogger()")]),t._v("\nloggerCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onBuildLogger")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("type"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" loggerConfigs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" defaultConfigs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在文件名中附加日志输出的次数")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" fileName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" count "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" defaultConfigs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 应用至原有的参数合并逻辑中")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" params "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("assign")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" defaultConfigs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" loggerConfigs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" fileName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("fileName"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("_")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("count"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" configs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("assign")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" defaultConfigs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" loggerConfigs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" params "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("configs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 进行日志输出")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  count "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在创建日志输出组时传入count")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" logger "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" loggerCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createGroupLogger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fileName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'LogFile'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'一个🌰日志'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br")])]),a("hr"),t._v(" "),a("p",[t._v("对于"),a("strong",[t._v("日志输出器实例何时创建")]),t._v("，"),a("strong",[t._v("LoggerCore")]),t._v("将根据在"),a("strong",[t._v("输出器配置列表")]),t._v("中指定的"),a("strong",[t._v("构建触发方式")]),t._v("决定创建"),a("strong",[t._v("日志输出器")]),t._v("实例的时间点。")]),t._v(" "),a("h4",{attrs:{id:"实例化阶段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实例化阶段"}},[t._v("#")]),t._v(" 实例化阶段")]),t._v(" "),a("hr"),t._v(" "),a("ol",[a("li",[a("p",[t._v("根据"),a("strong",[t._v("构建触发方式")]),t._v("对"),a("strong",[t._v("输出器配置列表")]),t._v("中的配置对象进行分类。")])]),t._v(" "),a("li",[a("p",[t._v("提取分类结果中使用"),a("code",[t._v("init")]),t._v("方式触发构建的配置对象，逐个使用配置对象内指定的配置执行"),a("code",[t._v("onBuildLogger()")]),t._v("创建对应的"),a("strong",[t._v("日志输出器")]),t._v("实例并存储在实例属性"),a("code",[t._v("_baseLoggerObjects")]),t._v("中。")])])]),t._v(" "),a("h4",{attrs:{id:"执行creategrouplogger"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行creategrouplogger"}},[t._v("#")]),t._v(" 执行"),a("code",[t._v("createGroupLogger()")])]),t._v(" "),a("hr"),t._v(" "),a("ol",[a("li",[a("p",[t._v("根据"),a("code",[t._v("createGroupLogger()")]),t._v("传入的"),a("strong",[t._v("配置参数")]),t._v("和"),a("strong",[t._v("LoggerCore")]),t._v("实例的"),a("strong",[t._v("配置参数")]),t._v("生成"),a("strong",[t._v("默认配置参数")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("提取并迭代分类结果中使用"),a("code",[t._v("create")]),t._v("方式触发构建的配置对象，使用配置对象内指定的配置参数和"),a("strong",[t._v("默认配置参数")]),t._v("执行"),a("code",[t._v("onBuildLogger()")]),t._v("创建对应的"),a("strong",[t._v("日志输出器")]),t._v("实例。")])]),t._v(" "),a("li",[a("p",[t._v("合并"),a("strong",[t._v("LoggerCore")]),t._v("实例属性"),a("code",[t._v("_baseLoggerObjects")]),t._v("中存储的"),a("strong",[t._v("日志输出器")]),t._v("实例和①中创建的"),a("strong",[t._v("日志输出器")]),t._v("实例组成待植入"),a("strong",[t._v("日志输出组")]),t._v("实例的"),a("strong",[t._v("日志输出器实例列表")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("根据"),a("code",[t._v("createGroupLogger()")]),t._v("传入的"),a("strong",[t._v("日志输出组类型")]),t._v("，创建对应的"),a("strong",[t._v("日志输出组")]),t._v("实例并向其植入②中得到的"),a("strong",[t._v("日志输出器实例列表")]),t._v("。")])])]),t._v(" "),a("h3",{attrs:{id:"创建输出组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建输出组"}},[t._v("#")]),t._v(" 创建输出组")]),t._v(" "),a("p",[t._v("在实现细节上，"),a("strong",[t._v("日志输出组")]),t._v("继承自"),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#基础输出器"}},[t._v("基础输出器")]),t._v("，本质上是一个"),a("strong",[t._v("高阶日志输出器")]),t._v("。虽然目前没有开放指定"),a("strong",[t._v("日志输出组")]),t._v("的"),a("strong",[t._v("功能配置参数")]),t._v("的相关API，我们可以通过在启动"),a("strong",[t._v("日志输出组")]),t._v("之前修改其实例属性以控制其表现行为，目前支持修改"),a("strong",[t._v("日志输出组")]),t._v("的以下属性：")],1),t._v(" "),a("ul",[a("li",[a("code",[t._v("_errorHandler")])]),t._v(" "),a("li",[a("code",[t._v("_checkStateInLog")])]),t._v(" "),a("li",[a("code",[t._v("_checkStateInStart")])]),t._v(" "),a("li",[a("code",[t._v("_checkStateInClose")])])]),t._v(" "),a("p",[t._v("我们可以在"),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#基础输出器"}},[t._v("基础输出器")]),t._v("的"),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#功能参数"}},[t._v("功能参数")]),t._v("一节中根据其同名的"),a("strong",[t._v("功能配置参数")]),t._v("了解这些实例属性的作用。")],1),t._v(" "),a("hr"),t._v(" "),a("p",[a("code",[t._v("createGroupLogger()")]),t._v("支持多种调用方式：")]),t._v(" "),a("ul",[a("li",[a("strong",[a("code",[t._v("createGroupLogger()")])]),t._v("：不指定配置参数创建"),a("a",{attrs:{href:"#%E5%9F%BA%E7%A1%80%E8%BE%93%E5%87%BA%E7%BB%84"}},[t._v("基础输出组")]),t._v("的实例。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("createGroupLogger(type)")])]),t._v("：不指定配置参数创建指定的"),a("strong",[t._v("日志输出组")]),t._v("的实例。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("createGroupLogger(configs)")])]),t._v("：使用指定配置参数创建"),a("a",{attrs:{href:"#%E5%9F%BA%E7%A1%80%E8%BE%93%E5%87%BA%E7%BB%84"}},[t._v("基础输出组")]),t._v("的实例。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("createGroupLogger(type, configs)")])]),t._v("：使用指定配置参数创建指定的"),a("strong",[t._v("日志输出组")]),t._v("的实例。")])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[a("code",[t._v("createGroupLogger()")]),t._v("执行过程中将对使用的"),a("strong",[t._v("日志输出组")]),t._v("类型进行校验。出于保证应用程序的可用性考虑，如果使用了无效的"),a("strong",[t._v("日志输出组")]),t._v("类型（即：非继承自"),a("a",{attrs:{href:"#%E5%9F%BA%E7%A1%80%E8%BE%93%E5%87%BA%E7%BB%84"}},[t._v("基础输出组")]),t._v("的"),a("RouterLink",{attrs:{to:"/guide/logger-group-customizing.html"}},[t._v("自定义输出组")]),t._v("），将默认创建"),a("strong",[t._v("基础输出组")]),t._v("的实例。")],1)]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("接下来，我们使用"),a("strong",[t._v("LoggerCore")]),t._v("实现一个复杂的组合日志输出场景：")]),t._v(" "),a("p",[a("strong",[t._v("目标1")]),t._v("：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("保留最近5个归档日期内的日志。")])]),t._v(" "),a("li",[a("p",[t._v("将每秒内产生的日志归档至同一"),a("strong",[t._v("日志文件")]),t._v("，超出"),a("code",[t._v("1KB")]),t._v("时自动分割。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("日志文件")]),t._v("按照"),a("strong",[t._v("归档前缀")]),t._v("存储，且"),a("strong",[t._v("日志文件名")]),t._v("中不展示"),a("strong",[t._v("归档前缀")]),t._v("。")])])]),t._v(" "),a("p",[a("strong",[t._v("目标2")]),t._v("：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("保留最近10秒内的日志。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("日志文件名")]),t._v("中展示"),a("strong",[t._v("归档时间")]),t._v("，但不展示"),a("strong",[t._v("归档前缀")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("日志文件")]),t._v("按照"),a("strong",[t._v("归档前缀")]),t._v("存储，并将每5秒内产生的"),a("strong",[t._v("日志文件")]),t._v("归档至同一文件。")])])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Core "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node-corejs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建LoggerCore")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" loggerCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LoggerCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  env"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'prod'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  level"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'infos'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定统一的归档源目录")]),t._v("\n    sourcePath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./testlogs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  loggers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用共享的日期输出器实现目标1")]),t._v("\n    type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DateLogger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    buildTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'init'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在LoggerCore实例化时创建日期输出器")]),t._v("\n    startTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 日期输出器自动启动,LoggerCore无需控制其启动动作")]),t._v("\n    closeTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      filePrefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cycle_1s'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 归档前缀")]),t._v("\n      keepDateNum"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 保留最近5个归档日期")]),t._v("\n      maxSize"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 最大日志文件体积为1K")]),t._v("\n      dateFormat"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'YYYY-MM-DD_HH_mm_ss'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以秒作为归档周期")]),t._v("\n      filePrefixAsFileName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 日志文件名不附加归档前缀")]),t._v("\n      filePrefixAsSourcePath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在归档源目录中创建归档前缀目录")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用非共享的文件输出器实现目标2")]),t._v("\n    type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FileLogger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    buildTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'create'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在执行createGroupLogger()时创建新的文件输出器")]),t._v("\n    startTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件输出器自动启动,LoggerCore无需控制其启动动作")]),t._v("\n    closeTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 文件输出器自动关闭,LoggerCore无需控制其关闭动作")]),t._v("\n    params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      filePrefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Duration_5s'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 归档前缀")]),t._v("\n      keepDateNum"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 保留最近2个归档日期，2*5=10秒")]),t._v("\n      fileName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'_'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 归档文件名")]),t._v("\n      filePrefixAsFileName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 日志文件名不附加归档前缀")]),t._v("\n      filePrefixAsSourcePath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在归档源目录中创建归档前缀目录")]),t._v("\n      dateFormat"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'YYYY-MM-DD_HH_mm_ss'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以秒作为归档周期")]),t._v("\n      dateAsFileName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 日志文件名附加归档日期")]),t._v("\n      dateAsSourcePath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不使用归档日期分类日志文件")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" logger "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 每五秒创建新的日志输出组")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("refreshLogger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  logger "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  logger "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" loggerCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createGroupLogger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("refreshLogger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("refreshLogger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 每100ms输出一次日志")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'一个🌰日志'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br"),a("span",{staticClass:"line-number"},[t._v("38")]),a("br"),a("span",{staticClass:"line-number"},[t._v("39")]),a("br"),a("span",{staticClass:"line-number"},[t._v("40")]),a("br"),a("span",{staticClass:"line-number"},[t._v("41")]),a("br"),a("span",{staticClass:"line-number"},[t._v("42")]),a("br"),a("span",{staticClass:"line-number"},[t._v("43")]),a("br"),a("span",{staticClass:"line-number"},[t._v("44")]),a("br"),a("span",{staticClass:"line-number"},[t._v("45")]),a("br"),a("span",{staticClass:"line-number"},[t._v("46")]),a("br"),a("span",{staticClass:"line-number"},[t._v("47")]),a("br"),a("span",{staticClass:"line-number"},[t._v("48")]),a("br"),a("span",{staticClass:"line-number"},[t._v("49")]),a("br"),a("span",{staticClass:"line-number"},[t._v("50")]),a("br"),a("span",{staticClass:"line-number"},[t._v("51")]),a("br"),a("span",{staticClass:"line-number"},[t._v("52")]),a("br"),a("span",{staticClass:"line-number"},[t._v("53")]),a("br"),a("span",{staticClass:"line-number"},[t._v("54")]),a("br"),a("span",{staticClass:"line-number"},[t._v("55")]),a("br"),a("span",{staticClass:"line-number"},[t._v("56")]),a("br"),a("span",{staticClass:"line-number"},[t._v("57")]),a("br")])]),a("h2",{attrs:{id:"基础输出组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础输出组"}},[t._v("#")]),t._v(" 基础输出组")]),t._v(" "),a("p",[a("strong",[t._v("基础输出组")]),t._v("提供了组合"),a("strong",[t._v("日志输出器")]),t._v("并控制其行为的基本能力。因此，我们在"),a("RouterLink",{attrs:{to:"/guide/logger-group-customizing.html"}},[t._v("自定义输出组")]),t._v("时需要继承"),a("strong",[t._v("基础输出组")]),t._v("。")],1),t._v(" "),a("p",[t._v("需要注意的是，在"),a("strong",[t._v("LoggerCore")]),t._v("实例执行"),a("code",[t._v("createGroupLogger()")]),t._v("时，如果指定了无效的"),a("strong",[t._v("日志输出组")]),t._v("类型将默认创建"),a("strong",[t._v("基础输出组")]),t._v("的实例。")]),t._v(" "),a("h3",{attrs:{id:"运行原理-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行原理-2"}},[t._v("#")]),t._v(" 运行原理")]),t._v(" "),a("p",[a("strong",[t._v("基础输出组")]),t._v("实质上通过"),a("RouterLink",{attrs:{to:"/guide/logger-customizing.html"}},[t._v("自定义输出器")]),t._v("的方式实现，我们将围绕定制部分讨论"),a("strong",[t._v("基础输出组")]),t._v("的运行原理。")],1),t._v(" "),a("h4",{attrs:{id:"构造函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构造函数"}},[t._v("#")]),t._v(" 构造函数")]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("我们已经知道，"),a("strong",[t._v("LoggerCore")]),t._v("在创建"),a("strong",[t._v("日志输出组")]),t._v("时会向其中植入"),a("strong",[t._v("日志输出器实例列表")]),t._v("。其实，"),a("strong",[t._v("日志输出组")]),t._v("将持有其对应的"),a("strong",[t._v("LoggerCore")]),t._v("实例的引用以维持派生关系。因此，"),a("strong",[t._v("日志输出组")]),t._v("的构造函数接收两个参数：")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("loggerCore")]),t._v("：创建"),a("strong",[t._v("日志输出组")]),t._v("的"),a("strong",[t._v("LoggerCore")]),t._v("实例")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("_loggerObjects")]),t._v("："),a("strong",[t._v("日志输出器")]),t._v("的实例列表")])])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("在构造阶段，"),a("strong",[t._v("日志输出组")]),t._v("执行了三个动作：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("将派生"),a("strong",[t._v("日志输出组")]),t._v("的"),a("strong",[t._v("LoggerCore")]),t._v("实例存储至实例属性"),a("code",[t._v("loggerCore")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("将"),a("strong",[t._v("日志输出器实例列表")]),t._v("作为自定义功能配置参数生成"),a("strong",[t._v("日志输出组")]),t._v("的配置对象。")])]),t._v(" "),a("li",[a("p",[t._v("使用②中得到的配置对象执行"),a("code",[t._v("super()")]),t._v("操作完成实例化。")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("在"),a("RouterLink",{attrs:{to:"/guide/logger-customizing.html"}},[t._v("自定义输出器")]),t._v("时执行"),a("code",[t._v("super()")]),t._v("操作将自动引导构造流程进入初始化阶段。")],1),t._v(" "),a("p",[t._v("因此，为了避免执行逻辑混乱，在"),a("strong",[t._v("构造函数")]),t._v("中仅使用功能配置参数的缓存机制存储"),a("strong",[t._v("日志输出器实例列表")]),t._v("，而将实际的构造逻辑放在"),a("a",{attrs:{href:"#initlogger"}},[t._v("初始化阶段")]),t._v("。")])]),t._v(" "),a("h4",{attrs:{id:"initlogger"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#initlogger"}},[t._v("#")]),t._v(" "),a("code",[t._v("initLogger()")])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("在讨论"),a("a",{attrs:{href:"#loggercore"}},[t._v("LoggerCore")]),t._v("时我们已经提到过，"),a("strong",[t._v("日志输出器实例列表")]),t._v("中的元素其实并不仅仅是"),a("strong",[t._v("日志输出器")]),t._v("实例本身，而是一个包含了"),a("strong",[t._v("日志输出器")]),t._v("的行为触发方式的"),a("code",[t._v("Object")]),t._v("。"),a("strong",[t._v("日志输出组")]),t._v("将根据"),a("strong",[t._v("行为触发方式")]),t._v("控制其组合的"),a("strong",[t._v("日志输出器")]),t._v("执行启动/关闭动作。")]),t._v(" "),a("p",[t._v("因此，出于性能考虑，在初始化阶段中将预先解析"),a("strong",[t._v("日志输出器实例列表")]),t._v("提取"),a("strong",[t._v("日志输出器")]),t._v("实例完成时空转换：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("提取使用"),a("code",[t._v("normal")]),t._v("方式触发启动的"),a("strong",[t._v("日志输出器")]),t._v("实例，存储在实例属性"),a("code",[t._v("_needStartLoggers")]),t._v("中。")])]),t._v(" "),a("li",[a("p",[t._v("提取使用"),a("code",[t._v("normal")]),t._v("方式触发关闭的"),a("strong",[t._v("日志输出器")]),t._v("实例，存储在实例属性"),a("code",[t._v("_needCloseLoggers")]),t._v("中。")])]),t._v(" "),a("li",[a("p",[t._v("将所有"),a("strong",[t._v("日志输出器")]),t._v("实例存储在实例属性"),a("code",[t._v("_loggers")]),t._v("中。")])])]),t._v(" "),a("h4",{attrs:{id:"onstart"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onstart"}},[t._v("#")]),t._v(" "),a("code",[t._v("onStart()")])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("在"),a("strong",[t._v("日志输出组")]),t._v("的"),a("strong",[t._v("启动阶段")]),t._v("，不仅需要变更"),a("strong",[t._v("日志输出组")]),t._v("为启动状态；对于使用"),a("code",[t._v("normal")]),t._v("作为启动触发方式的"),a("strong",[t._v("日志输出器")]),t._v("，还需在此阶段执行启动动作。因此，在"),a("strong",[t._v("启动阶段")]),t._v("：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("执行"),a("code",[t._v("super.onStart()")]),t._v("尝试变更"),a("strong",[t._v("日志输出组")]),t._v("为启动状态，如果变更状态失败则不再执行②。")])]),t._v(" "),a("li",[a("p",[t._v("迭代实例属性"),a("code",[t._v("_needStartLoggers")]),t._v("，执行每个"),a("strong",[t._v("日志输出器")]),t._v("实例的启动逻辑。")])])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("指定"),a("strong",[t._v("日志输出组")]),t._v("实例的实例属性"),a("code",[t._v("_checkStateInStart")]),t._v("将控制执行"),a("code",[t._v("super.onStart()")]),t._v("时是否在变更"),a("strong",[t._v("日志输出组")]),t._v("启动状态前执行状态校验进而影响"),a("strong",[t._v("执行结果")]),t._v("。")]),t._v(" "),a("p",[t._v("在"),a("strong",[t._v("启动阶段")]),t._v("的默认行为下，将通过判断"),a("code",[t._v("super.onStart()")]),t._v("的"),a("strong",[t._v("执行结果")]),t._v("以避免"),a("strong",[t._v("日志输出器")]),t._v("的启动逻辑多次执行。因此，请谨慎调整"),a("code",[t._v("_checkStateInStart")]),t._v("。")])]),t._v(" "),a("h4",{attrs:{id:"onclose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onclose"}},[t._v("#")]),t._v(" "),a("code",[t._v("onClose()")])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("与"),a("strong",[t._v("日志输出组")]),t._v("的"),a("strong",[t._v("启动阶段")]),t._v("类似，"),a("strong",[t._v("关闭阶段")]),t._v("不仅需要变更"),a("strong",[t._v("日志输出组")]),t._v("为关闭状态；对于使用"),a("code",[t._v("normal")]),t._v("作为关闭触发方式的"),a("strong",[t._v("日志输出器")]),t._v("，还需在此阶段执行关闭动作。因此，在"),a("strong",[t._v("关闭阶段")]),t._v("：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("执行"),a("code",[t._v("super.onClose()")]),t._v("尝试变更"),a("strong",[t._v("日志输出组")]),t._v("为关闭状态，如果变更状态失败则不再执行②。")])]),t._v(" "),a("li",[a("p",[t._v("迭代实例属性"),a("code",[t._v("_needCloseLoggers")]),t._v("，执行每个"),a("strong",[t._v("日志输出器")]),t._v("实例的关闭逻辑。")])])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("指定"),a("strong",[t._v("日志输出组")]),t._v("实例的实例属性"),a("code",[t._v("_checkStateInClose")]),t._v("将控制执行"),a("code",[t._v("super.onClose()")]),t._v("时是否在变更"),a("strong",[t._v("日志输出组")]),t._v("启动状态前执行状态校验进而影响"),a("strong",[t._v("执行结果")]),t._v("。")]),t._v(" "),a("p",[t._v("在"),a("strong",[t._v("关闭阶段")]),t._v("的默认行为下，将通过判断"),a("code",[t._v("super.onClose()")]),t._v("的"),a("strong",[t._v("执行结果")]),t._v("以避免"),a("strong",[t._v("日志输出器")]),t._v("的关闭逻辑多次执行。因此，请谨慎调整"),a("code",[t._v("_checkStateInClose")]),t._v("。")])]),t._v(" "),a("h4",{attrs:{id:"onlog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onlog"}},[t._v("#")]),t._v(" "),a("code",[t._v("onLog()")])]),t._v(" "),a("p",[a("strong",[t._v("日志输出组")]),t._v("本身并不产生任何日志，而是通过控制其组合的"),a("strong",[t._v("日志输出器")]),t._v("输出日志。因此，"),a("strong",[t._v("日志输出组")]),t._v("执行输出动作时：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("使用"),a("code",[t._v("onCheckState(BASE_LOGGER_STATE_TYPE_CAN_LOG)")]),t._v("检测当前状态是否允许日志输出，在"),a("strong",[t._v("日志输出组")]),t._v("当前状态不允许日志输出时将抛出异常信息且不再执行②。")])]),t._v(" "),a("li",[a("p",[t._v("迭代实例属性"),a("code",[t._v("_loggers")]),t._v("，执行每个"),a("strong",[t._v("日志输出器")]),t._v("实例的"),a("code",[t._v("log()")]),t._v("进行日志输出。")])])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("指定"),a("strong",[t._v("日志输出组")]),t._v("实例的实例属性"),a("code",[t._v("_checkStateInLog")]),t._v("将控制执行"),a("code",[t._v("onCheckState(BASE_LOGGER_STATE_TYPE_CAN_LOG)")]),t._v("时是否执行"),a("strong",[t._v("日志输出组")]),t._v("的启动状态校验。")]),t._v(" "),a("p",[t._v("在默认的输出行为中，未启动"),a("strong",[t._v("日志输出组")]),t._v("时将拒绝执行实际输出动作以保证资源的有效性。因此，请谨慎调整"),a("code",[t._v("_checkStateInLog")]),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"定制输出组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定制输出组"}},[t._v("#")]),t._v(" 定制输出组")]),t._v(" "),a("p",[t._v("在本节中，我们将定制一个简单的"),a("strong",[t._v("日志输出组")]),t._v("用于客户端请求处理链路的日志收集：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("记录"),a("code",[t._v("start()")]),t._v("和"),a("code",[t._v("close()")]),t._v("时间差统计处理耗时。")])]),t._v(" "),a("li",[a("p",[t._v("执行"),a("code",[t._v("start()")]),t._v("和"),a("code",[t._v("close()")]),t._v("时自动输出开启和关闭日志。")])])]),t._v(" "),a("p",[t._v("首先，我们通过继承自"),a("code",[t._v("Core.GroupLogger")]),t._v("的方式实现一个自定义的"),a("strong",[t._v("日志输出组")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Core "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node-corejs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 自定义日志输出组\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HandlerLogger")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GroupLogger")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initLogger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initLogger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("configs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("startTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onStart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 尝试执行原始启动逻辑")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在原始启动逻辑执行失败时不再执行后续逻辑")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onStart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动成功时记录启动时间并输出日志")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("startTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'i'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'处理开始'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("请求处理的开始时间:[")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("formatDate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("startTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'YYYY-MM-DD HH:mm:ss.SSS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onClose")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检测当前状态是否允许输出日志")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 允许输出日志时将记录关闭时间并输出日志")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onCheckState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Macros"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BASE_LOGGER_CHECK_TYPE_CAN_LOG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" closeTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'i'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'处理结束'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("请求处理的结束时间:[")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("formatDate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("closeTime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'YYYY-MM-DD HH:mm:ss.SSS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("}],处理耗时:[")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("closeTime "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("startTime"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("]ms")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行原始的关闭逻辑")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onClose")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br")])]),a("p",[t._v("接下来，我们确定日志收集的场景：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("将每次客户端请求处理链路中产生的日志输出至同一文件。")])]),t._v(" "),a("li",[a("p",[t._v("按照"),a("strong",[t._v("请求路径")]),t._v("和"),a("strong",[t._v("请求日期")]),t._v("对"),a("strong",[t._v("日志文件")]),t._v("进行分类。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("日志文件名")]),t._v("中需要保留"),a("strong",[t._v("请求方式")]),t._v("和"),a("strong",[t._v("请求时间")]),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("保留最近"),a("strong",[t._v("7")]),t._v("天的日志。")])])]),t._v(" "),a("p",[t._v("因此，我们可以按照以下方式创建"),a("strong",[t._v("LoggerCore")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" loggerCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("LoggerCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  env"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'prod'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  level"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'infos'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" sourcePath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./testlogs'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  loggers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FileLogger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      buildTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'create'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      startTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'normal'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      closeTrigger"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'normal'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        auto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用手动模式")]),t._v("\n        dateFormat"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'YYYY-MM-DD'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 以天作为归档周期")]),t._v("\n        keepDateNum"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 保留最近7个归档日期")]),t._v("\n        dateAsFileName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 日志文件名不附加归档日期")]),t._v("\n        dateAsSourcePath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用归档日期分类日志文件")]),t._v("\n        filePrefixAsFileName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 日志文件名不附加归档前缀")]),t._v("\n        filePrefixAsSourcePath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用归档前缀分类日志文件")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br")])]),a("p",[t._v("最后，让我们结合"),a("strong",[t._v("ServiceCore")]),t._v("实现对客户端请求处理链路的日志收集：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestHandler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Handler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRoutePath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/Test.do'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在初始化阶段创建日志输出组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" method "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toUpperCase")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logger "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" loggerCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createGroupLogger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HandlerLogger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      params"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        filePrefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Test.do'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        fileName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("method"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Utils"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("formatDate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'YYYY-MM-DD_HH_mm_ss_SSS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("-[%RANDOM_FILE_NAME%]")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动日志输出组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 记录链路日志")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'i'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'进入GET处理阶段'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'i'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'GET处理结束,向客户端返回'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("destroyHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在析构阶段关闭日志输出组")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logger"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建ServiceCore")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" serviceCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("serviceCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("TestHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nserviceCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br"),a("span",{staticClass:"line-number"},[t._v("32")]),a("br"),a("span",{staticClass:"line-number"},[t._v("33")]),a("br"),a("span",{staticClass:"line-number"},[t._v("34")]),a("br"),a("span",{staticClass:"line-number"},[t._v("35")]),a("br"),a("span",{staticClass:"line-number"},[t._v("36")]),a("br"),a("span",{staticClass:"line-number"},[t._v("37")]),a("br")])]),a("p",[t._v("现在，我们可以通过访问使用"),a("code",[t._v("curl http://localhost:3000/Test.do")]),t._v("来检验实现成功啦！")])])}),[],!1,null,null,null);s.default=r.exports}}]);