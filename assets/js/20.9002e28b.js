(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{339:function(t,s,a){"use strict";a.r(s);var n=a(33),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"web服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#web服务"}},[t._v("#")]),t._v(" Web服务")]),t._v(" "),a("h2",{attrs:{id:"启动web服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动web服务"}},[t._v("#")]),t._v(" 启动Web服务")]),t._v(" "),a("p",[t._v("我们使用Corejs内置的"),a("strong",[t._v("ServiceCore")]),t._v("创建和管理"),a("strong",[t._v("Web服务")]),t._v("。启动"),a("strong",[t._v("Web服务")]),t._v("分为两个步骤：")]),t._v(" "),a("p",[a("strong",[t._v("首先，使用"),a("code",[t._v("Core.ServiceCore")]),t._v("创建ServiceCore实例：")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Core "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node-corejs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" serviceCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("创建"),a("strong",[t._v("ServiceCore")]),t._v("时可以指定"),a("strong",[t._v("Web服务")]),t._v("的配置对象"),a("code",[t._v("configs")]),t._v("：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[a("code",[t._v("configs.id")])]),t._v("："),a("strong",[t._v("ServiceCore")]),t._v("的ID，用于标识"),a("strong",[t._v("ServiceCore")]),t._v("。非必填项，默认值："),a("code",[t._v("ServiceCore_${generateRandomString(6, 'uln')}")]),t._v(";")])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("configs.port")])]),t._v("："),a("strong",[t._v("Web服务")]),t._v("驻留的端口。非必填项，默认值："),a("code",[t._v("3000")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("configs.serverOpt")])]),t._v("："),a("strong",[t._v("Web服务")]),t._v("的构建配置。非必填项，默认值："),a("code",[t._v("{}")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("configs.baseRoutePath")])]),t._v("："),a("strong",[t._v("Web服务")]),t._v("的基础请求路径，用于指定统一的请求路径前缀。非必填项，默认值："),a("code",[t._v("'/'")]),t._v("。")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("比如，当此配置指定为"),a("code",[t._v("'/api'")]),t._v("，且ServiceCore挂载了请求路径规则为"),a("code",[t._v("'/Test.do'")]),t._v("的Handler时，客户端需要请求"),a("code",[t._v("'/api/Test.do'")]),t._v("才能命中此Handler。")])])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[a("strong",[t._v("ServiceCore将自动校正配置对象中指定的基础请求路径：")])]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("当基础请求路径不以"),a("code",[t._v("'/'")]),t._v("开头时，将附加"),a("code",[t._v("'/'")]),t._v("作为前缀")]),t._v("。比如：当业务层指定"),a("strong",[t._v("基础请求路径")]),t._v("为"),a("code",[t._v("'api'")]),t._v("时将自动被校正为"),a("code",[t._v("'/api'")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("当基础请求路径以"),a("code",[t._v("'/'")]),t._v("结尾时，将删除位于结尾的所有"),a("code",[t._v("'/'")])]),t._v("。比如：当业务层指定"),a("strong",[t._v("基础请求路径")]),t._v("为"),a("code",[t._v("'/api//'")]),t._v("时将自动被校正为"),a("code",[t._v("'/api'")]),t._v("。")])])])])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("configs.middlewares")])]),t._v("：全局中间件列表。非必填项，默认值："),a("code",[t._v("[]")]),t._v("。")])])]),t._v(" "),a("hr"),t._v(" "),a("p",[a("strong",[t._v("然后，使用实例方法"),a("code",[t._v("start()")]),t._v("启动Web服务")]),t._v("。此方法接收两个非必填参数："),a("strong",[t._v("启动配置")]),t._v("和"),a("strong",[t._v("回调函数")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("serviceCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callBack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("对于构建配置"),a("code",[t._v("configs.serverOpt")]),t._v("和启动配置"),a("code",[t._v("options")]),t._v("，我们将在"),a("a",{attrs:{href:"#%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"}},[t._v("构建过程")]),t._v("一节中进行详细讨论。")])]),t._v(" "),a("p",[t._v("通常，我们在执行"),a("code",[t._v("start()")]),t._v("时使用"),a("strong",[t._v("回调函数")]),t._v("处理Web服务的启动结果：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("serviceCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果error为null则表示Web服务启动成功")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Web服务启动失败")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("服务启动失败: ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Web服务启动成功")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'服务启动成功'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[a("strong",[t._v("需要注意的是，"),a("code",[t._v("start()")]),t._v("执行成功后将会变更ServiceCore为启动状态，仅允许在关闭状态执行的操作将被拒绝执行：")])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E5%85%A8%E5%B1%80%E6%8B%A6%E6%88%AA%E5%99%A8"}},[t._v("设置全局拦截器")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E9%94%99%E8%AF%AF%E6%8B%A6%E6%88%AA%E5%99%A8"}},[t._v("设置错误拦截器")])]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"}},[t._v("自定义构建过程")])])]),t._v(" "),a("h2",{attrs:{id:"设置请求路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置请求路径"}},[t._v("#")]),t._v(" 设置请求路径")]),t._v(" "),a("p",[t._v("处理特定请求路径的客户端请求需要结合"),a("RouterLink",{attrs:{to:"/guide/request-handler.html"}},[t._v("Handler")]),t._v("进行。"),a("strong",[t._v("Handler")]),t._v("有独立于"),a("strong",[t._v("ServiceCore")]),t._v("的"),a("RouterLink",{attrs:{to:"/guide/request-handler.html#处理流程"}},[t._v("生命周期和处理流程")]),t._v("。")],1),t._v(" "),a("p",[t._v("客户端请求经过"),a("strong",[t._v("全局中间件")]),t._v("管道后，将进入与请求路径匹配的"),a("strong",[t._v("Handler")]),t._v("中执行后续处理。")]),t._v(" "),a("p",[a("strong",[t._v("我们实现一个Handler至少需要：")])]),t._v(" "),a("ul",[a("li",[t._v("指定请求路径规则")]),t._v(" "),a("li",[t._v("指定请求方式（比如：GET、POST）对应的处理逻辑")])]),t._v(" "),a("p",[t._v("因此，我们在"),a("RouterLink",{attrs:{to:"/guide/request-handler.html"}},[t._v("自定义Handler")]),t._v("时至少需要：")],1),t._v(" "),a("ul",[a("li",[a("strong",[t._v("实现一个继承自"),a("code",[t._v("Core.Handler")]),t._v("的类")])]),t._v(" "),a("li",[a("strong",[t._v("重写"),a("code",[t._v("getRoutePath")]),t._v("静态方法")]),t._v("，指定请求路径规则")]),t._v(" "),a("li",[a("strong",[t._v("重写"),a("code",[t._v("[METHOD]Handler")]),t._v("实例方法")]),t._v("，指定请求方式对应的处理逻辑")])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[a("strong",[t._v("指定请求路径规则时，需要重写Handler中的静态方法，即"),a("code",[t._v("static getRoutePath()")]),t._v("；而实现某个请求方式的处理逻辑时重写的"),a("code",[t._v("[METHOD]Handler")]),t._v("是实例方法。")])]),t._v(" "),a("p",[t._v("另外，"),a("strong",[a("code",[t._v("[METHOD]Handler")]),t._v("不是实际重写的方法名，只是Handler Method的代称")]),t._v("，比如：期望处理客户端POST请求时，需要重写"),a("strong",[t._v("Handler")]),t._v("中的"),a("strong",[t._v("实例方法")]),a("code",[t._v("postHandler")]),t._v("。")])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("接下来，让我们来实现Hello World Handler：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HelloWorldHandler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Handler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定请求路径规则")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRoutePath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/HelloWorld.do'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定get请求处理")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("p",[t._v("需要注意的是，"),a("strong",[t._v("Handler必须绑定至ServiceCore才能生效。")])]),t._v(" "),a("p",[t._v("所以，我们还应该使用"),a("strong",[t._v("ServiceCore")]),t._v("的实例方法"),a("code",[t._v("bind()")]),t._v("将"),a("strong",[t._v("Handler")]),t._v("与"),a("strong",[t._v("ServiceCore")]),t._v("绑定：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 实现Hello World Handler")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HelloWorldHandler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Handler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建ServiceCore")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" serviceCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 绑定ServiceCore和Handler")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("serviceCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("HelloWorldHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动ServiceCore")]),t._v("\nserviceCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[a("strong",[t._v("最后，我们使用浏览器打开"),a("code",[t._v("http://localhost:3000/HelloWorld.do")]),t._v("就可以检查实现成果啦！")])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[a("strong",[t._v("ServiceCore实例仅允许在处于关闭状态时执行"),a("code",[t._v("bind()")]),t._v("动作，且多次执行"),a("code",[t._v("bind()")]),t._v("时将只保留最后一次绑定的Handler。")])])]),t._v(" "),a("h2",{attrs:{id:"构建过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建过程"}},[t._v("#")]),t._v(" 构建过程")]),t._v(" "),a("p",[a("strong",[t._v("ServiceCore")]),t._v("执行实例方法"),a("code",[t._v("start()")]),t._v("时将触发"),a("strong",[t._v("Web服务")]),t._v("的实际构建，"),a("strong",[t._v("我们可以通过修改实例属性"),a("code",[t._v("createServer")]),t._v("对构建过程进行定制。")])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[a("strong",[t._v("ServiceCore实例仅允许在处于关闭状态时变更其"),a("code",[t._v("createServer")]),t._v("属性。")])]),t._v(" "),a("p",[t._v("构建过程中需要包含"),a("strong",[t._v("构建Server")]),t._v("和"),a("strong",[t._v("启动Server")]),t._v("两个阶段。")])]),t._v(" "),a("p",[a("strong",[t._v("ServiceCore")]),t._v("的实例属性"),a("code",[t._v("createServer")]),t._v("应"),a("strong",[t._v("根据构建过程内实际逻辑的同步或异步使用"),a("code",[t._v("Function")]),t._v("或"),a("code",[t._v("AsyncFunction")])]),t._v("，其参数列表依次为：")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[a("code",[t._v("options")])]),t._v("：执行"),a("code",[t._v("start()")]),t._v("时指定的"),a("strong",[t._v("启动配置")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("app")])]),t._v("："),a("strong",[t._v("ServiceCore")]),t._v("自动构建的"),a("strong",[t._v("Express实例")]),t._v("。")])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("configs")])]),t._v("："),a("strong",[t._v("ServiceCore")]),t._v("实例化时指定的构造参数。")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("ServiceCore在实例化过程中将自动对构造参数中指定的配置进行校正。因此可能与创建ServiceCore时实际指定的构造参数有差异。")])])])]),t._v(" "),a("li",[a("p",[a("strong",[a("code",[t._v("callBack")])]),t._v("：回调函数，参数列表为"),a("code",[t._v("(error, detail)")]),t._v("。")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("ServiceCore将根据此函数回调的信息对构建结果进行仲裁，当回调的"),a("code",[t._v("error")]),t._v("为"),a("code",[t._v("null")]),t._v("时表示构建成功，此时ServiceCore将被变更为启动状态。")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("说明")]),t._v(" "),a("p",[t._v("我们可以在定制"),a("strong",[t._v("构建过程")]),t._v("时，使用期望的"),a("code",[t._v("error")]),t._v("和"),a("code",[t._v("detail")]),t._v("调用"),a("code",[t._v("callBack")]),t._v("，以控制"),a("strong",[t._v("ServiceCore")]),t._v("实例方法"),a("code",[t._v("start()")]),t._v("回调启动结果时的附加信息。")]),t._v(" "),a("p",[a("strong",[t._v("在默认的构建过程下，"),a("code",[t._v("detail")]),t._v("的结构为"),a("code",[t._v("{ app, server, serverType }")]),t._v("：")])]),t._v(" "),a("ul",[a("li",[a("strong",[a("code",[t._v("app")])]),t._v("："),a("strong",[t._v("ServiceCore")]),t._v("自动构建的"),a("strong",[t._v("Express实例")]),t._v("。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("server")])]),t._v("：支撑"),a("strong",[t._v("Web服务")]),t._v("的Server实例。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("serverType")])]),t._v("："),a("strong",[t._v("Server实例")]),t._v("的类型，为"),a("code",[t._v("'http'")]),t._v("或"),a("code",[t._v("'https'")]),t._v("。")])])])])]),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("接下来，我们将结合默认构建过程的实现，来讨论创建"),a("strong",[t._v("ServiceCore")]),t._v("时指定的"),a("code",[t._v("configs.serverOpt")]),t._v("和执行"),a("code",[t._v("start()")]),t._v("时指定的"),a("code",[t._v("options")]),t._v("的作用。")]),t._v(" "),a("p",[t._v("默认的构建过程实现如下：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" configs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callBack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 参数处理")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" serverOpt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" configs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  options "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("assign")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" port "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建server")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" server "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" serverType "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当指定了有效的ssl配置时 - 启动https服务器")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serverOpt "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" serverOpt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cert "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" serverOpt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serverOpt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    serverType "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 未指定ssl或配置无效时 - 启动http服务器")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    server "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serverOpt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    serverType "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 启动server")]),t._v("\n  server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callBack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'listening'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callBack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" serverType "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br")])]),a("p",[t._v("因此，在创建"),a("strong",[t._v("ServiceCore")]),t._v("时，如果指定了有效的"),a("code",[t._v("configs.serverOpt.key")]),t._v("和"),a("code",[t._v("configs.serverOpt.cert")]),t._v("，则在执行"),a("code",[t._v("start()")]),t._v("时将使用"),a("code",[t._v("https.createServer()")]),t._v("创建Server实例，否则使用"),a("code",[t._v("http.createServer()")]),t._v("。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[a("strong",[a("code",[t._v("configs.serverOpt")]),t._v("将作为创建Server实例的配置参数；执行实例方法"),a("code",[t._v("start()")]),t._v("时指定的启动配置"),a("code",[t._v("options")]),t._v("将作为启动Server实例的配置参数。")])]),t._v(" "),a("p",[t._v("具体配置项可以参照"),a("a",{attrs:{href:"https://nodejs.org/en/docs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("NodeJS官方文档"),a("OutboundLink")],1),t._v("中"),a("code",[t._v("https.createServer()")]),t._v("、"),a("code",[t._v("http.createServer()")]),t._v("和"),a("code",[t._v("server.listen()")]),t._v("的相关描述。")])]),t._v(" "),a("h2",{attrs:{id:"tls-ssl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tls-ssl"}},[t._v("#")]),t._v(" TLS/SSL")]),t._v(" "),a("p",[t._v("如果我们期望启动TLS/SSL模式的Web服务，只需在实例化"),a("strong",[t._v("ServiceCore")]),t._v("时指定有效的"),a("code",[t._v("configs.serverOpt.key")]),t._v("和"),a("code",[t._v("configs.serverOpt.cert")]),t._v("即可。")]),t._v(" "),a("p",[t._v("我们在"),a("a",{attrs:{href:"#%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"}},[t._v("构建过程")]),t._v("一节已经了解到，默认的构建行为使用"),a("code",[t._v("https.createServer()")]),t._v("实现Web服务的TLS/SSL，因此：")]),t._v(" "),a("p",[a("strong",[t._v("我们可以通过指定证书和密钥文件路径的方式启动TLS/SSL模式的Web服务。")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSL_KEY_PATH")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./ssl.key'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSL_CERT_PATH")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./cert.pem'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" serviceCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  serverOpt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSL_KEY_PATH")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    cert"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSL_CERT_PATH")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("通常，直接指定证书和密钥文件的路径具有很大的局限性（比如：打包导致文件路径产生偏移）。")]),t._v(" "),a("p",[a("strong",[t._v("我们可以使用将证书和密钥装入"),a("code",[t._v("Buffer")]),t._v("的形式进行规避：")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSL_KEY_PATH")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./ssl.key'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSL_CERT_PATH")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./cert.pem'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" serviceCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  serverOpt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSL_KEY_PATH")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    cert"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" fs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSL_CERT_PATH")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("h2",{attrs:{id:"处理模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理模型"}},[t._v("#")]),t._v(" 处理模型")]),t._v(" "),a("p",[a("img",{attrs:{src:"/images/%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B.jpg",alt:"请求处理模型"}})]),t._v(" "),a("h2",{attrs:{id:"全局拦截器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局拦截器"}},[t._v("#")]),t._v(" 全局拦截器")]),t._v(" "),a("p",[t._v("进入"),a("strong",[t._v("ServiceCore")]),t._v("的所有客户端流量将被"),a("strong",[t._v("全局拦截器")]),t._v("捕获并处理。"),a("strong",[t._v("ServiceCore")]),t._v("将在业务层执行实例方法"),a("code",[t._v("start()")]),t._v("时，将"),a("strong",[t._v("全局拦截器")]),t._v("使用"),a("code",[t._v("app.use()")]),t._v("挂载至Express中间件列表首位。")]),t._v(" "),a("p",[a("strong",[t._v("我们可以通过修改ServiceCore的实例属性"),a("code",[t._v("globalIntercaptor")]),t._v("以对全局拦截器行为进行定制。")])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("在全局拦截器逻辑结束后，务必使用"),a("code",[t._v("next()")]),t._v("分发处理流程至后续阶段。")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("ServiceCore实例仅允许在处于关闭状态时变更其"),a("code",[t._v("globalIntercaptor")]),t._v("属性。")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("ServiceCore将自动捕获全局拦截器根函数维度产生的异常，使之进入"),a("a",{attrs:{href:"#%E9%94%99%E8%AF%AF%E6%8B%A6%E6%88%AA%E5%99%A8"}},[t._v("错误拦截器")]),t._v("处理。")]),t._v("（因此，推荐使用"),a("code",[t._v("async/await")]),t._v("执行异步动作以保证异常抛出）。")])])])]),t._v(" "),a("p",[a("strong",[t._v("ServiceCore")]),t._v("的实例属性"),a("code",[t._v("globalIntercaptor")]),t._v("应"),a("strong",[t._v("根据全局拦截器内实际逻辑的同步或异步使用"),a("code",[t._v("Function")]),t._v("或"),a("code",[t._v("AsyncFunction")])]),t._v("，其参数列表依次为：")]),t._v(" "),a("ul",[a("li",[a("strong",[a("code",[t._v("req")])]),t._v("：客户端请求实例。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("res")])]),t._v("：客户端返回实例。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("next")])]),t._v("：Express中间件流程控制函数，使用方式可以参考"),a("a",{attrs:{href:"http://expressjs.com/en/guide/using-middleware.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Express官方文档"),a("OutboundLink")],1),t._v("中对于"),a("code",[t._v("next()")]),t._v("的描述。")])]),t._v(" "),a("p",[a("strong",[t._v("在全局拦截器中不包含异步逻辑时，我们通常指定为"),a("code",[t._v("Function")]),t._v("类型：")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定同步全局拦截器")]),t._v("\nserviceCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("globalIntercaptor")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行全局拦截器逻辑")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拦截器逻辑结束后执行next()分发处理流程至下游链路")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[a("strong",[t._v("当全局拦截器中包含异步逻辑时，推荐指定为"),a("code",[t._v("AsyncFunction")]),t._v("类型以使用"),a("code",[t._v("await")]),t._v("指令进行异步操作：")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定异步全局拦截器")]),t._v("\nserviceCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("globalIntercaptor")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行全局拦截器逻辑")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拦截器逻辑结束后执行next()分发处理流程至下游链路")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("hr"),t._v(" "),a("p",[t._v("接下来，我们将结合默认全局拦截器的实现，来讨论其对后续处理过程产生的影响。")]),t._v(" "),a("p",[t._v("默认全局拦截器的实现如下：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("globalInterceptor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" requestPath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" routePathes "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("keys")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_handlerMap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isHandlerBinded "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" routePathes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" handlerRoutePath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" routePathes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("requestPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("baseRoutePath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" requestPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("indexOf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("handlerRoutePath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("isHandlerBinded "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("isHandlerBinded "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("p",[t._v("因此，"),a("strong",[t._v("如果客户端请求路径未能匹配到Handler，则认为请求无效直接返回404状态码，不再进入后续的"),a("a",{attrs:{href:"#%E5%85%A8%E5%B1%80%E4%B8%AD%E9%97%B4%E4%BB%B6"}},[t._v("全局中间件")]),t._v("和"),a("RouterLink",{attrs:{to:"/guide/request-handler.html"}},[t._v("Handler阶段")]),t._v("。")],1)]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[a("strong",[t._v("我们可能在"),a("a",{attrs:{href:"#%E5%85%A8%E5%B1%80%E4%B8%AD%E9%97%B4%E4%BB%B6"}},[t._v("全局中间件")]),t._v("中使用泛路径中间件（如："),a("code",[t._v("express.static")]),t._v("），默认的全局拦截器行为可能导致请求无效")]),t._v("。此类场景下，我们可以尝试：")]),t._v(" "),a("ul",[a("li",[t._v("将泛路径中间件变更至"),a("strong",[t._v("Handler")]),t._v("维度。")]),t._v(" "),a("li",[t._v("变更"),a("strong",[t._v("全局拦截器")]),t._v("默认行为，放行相关请求。")])])]),t._v(" "),a("h2",{attrs:{id:"全局中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局中间件"}},[t._v("#")]),t._v(" 全局中间件")]),t._v(" "),a("p",[t._v("我们把在"),a("a",{attrs:{href:"#%E5%85%A8%E5%B1%80%E6%8B%A6%E6%88%AA%E5%99%A8"}},[t._v("全局拦截器")]),t._v("中被放行的客户端请求称为"),a("strong",[t._v("有效请求")]),t._v("，作用于有效请求的中间件便是"),a("strong",[t._v("全局中间件")]),t._v("。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[a("strong",[t._v("全局中间件依赖于Express中间件系统实现，因此兼容Express生态且不支持动态中间件行为。")])]),t._v(" "),a("p",[t._v("对于"),a("strong",[t._v("作用于特定请求路径的中间件")]),t._v("，我们可以在"),a("RouterLink",{attrs:{to:"/guide/request-handler.html"}},[t._v("自定义Handler")]),t._v("时根据客户端请求的实际上下文（比如：请求参数）：")],1),t._v(" "),a("ul",[a("li",[a("strong",[t._v("动态指定中间件列表")])]),t._v(" "),a("li",[a("strong",[t._v("控制中间件执行规则")]),t._v("（比如：跳过执行）")])])]),t._v(" "),a("p",[a("strong",[t._v("全局中间件")]),t._v("由创建"),a("strong",[t._v("ServiceCore")]),t._v("时的构造参数"),a("code",[t._v("configs.middlewares")]),t._v("配置项指定：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" serviceCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  middlewares"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("hr"),t._v(" "),a("p",[a("strong",[t._v("ServiceCore")]),t._v("在业务层执行实例方法"),a("code",[t._v("start()")]),t._v("时，当挂载"),a("strong",[t._v("全局拦截器")]),t._v("完成后，将迭代构造参数"),a("code",[t._v("configs.middlewares")]),t._v("内的中间件，依次使用"),a("code",[t._v("app.use()")]),t._v("挂载至Express中间件列表。")]),t._v(" "),a("p",[t._v("因此，我们可以直接使用Express生态的中间件作为"),a("strong",[t._v("全局中间件")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" bodyParser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'body-parser'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建body-parser中间件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" jsonParser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bodyParser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" limit"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" urlEncodedParser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bodyParser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("urlencoded")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" limit"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" extended"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建ServiceCore并启动")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" serviceCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  middlewares"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("jsonParser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" urlEncodedParser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nserviceCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("需要注意的是，"),a("strong",[t._v("全局中间件不支持动态中间件")]),t._v("。在一些"),a("strong",[t._v("全局中间件")]),t._v("逻辑控制的场景中，我们可以使用"),a("strong",[t._v("Middleware Wrapper")]),t._v("实现。")]),t._v(" "),a("p",[t._v("接下来，我们将实现一个根据"),a("code",[t._v("body-parser")]),t._v("解析结果进行自定义处理的🌰，解析异常时不再向客户端抛出500状态码，而是使用200状态码向客户端返回异常信息：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" bodyParser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'body-parser'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" jsonParser "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" bodyParser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" limit"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对原始中间件进行包装,修改默认逻辑")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("jsonParserWrapper")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("jsonParser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建ServiceCore并启动")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" serviceCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  middlewares"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("jsonParserWrapper"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nserviceCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("h2",{attrs:{id:"错误拦截器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误拦截器"}},[t._v("#")]),t._v(" 错误拦截器")]),t._v(" "),a("p",[a("strong",[t._v("ServiceCore")]),t._v("引入了"),a("strong",[t._v("错误拦截器")]),t._v("用于收口请求处理过程中产生的异常。"),a("strong",[t._v("ServiceCore")]),t._v("在业务层执行实例方法"),a("code",[t._v("start()")]),t._v("时，当挂载"),a("strong",[t._v("全局拦截器")]),t._v("和"),a("strong",[t._v("全局中间件")]),t._v("完成后，将"),a("strong",[t._v("错误拦截器")]),t._v("使用"),a("code",[t._v("app.use()")]),t._v("挂载至Express中间件列表。")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[a("strong",[t._v("错误拦截器")]),t._v("本质上是一个位于Express中间件列表的末位的"),a("strong",[t._v("标准错误中间件")]),t._v("，将捕获到以下类型的异常：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"#%E5%85%A8%E5%B1%80%E6%8B%A6%E6%88%AA%E5%99%A8"}},[t._v("全局拦截器")]),t._v("执行过程中产生的异常")]),t._v(" "),a("li",[a("a",{attrs:{href:"#%E5%85%A8%E5%B1%80%E4%B8%AD%E9%97%B4%E4%BB%B6"}},[t._v("全局中间件")]),t._v("执行过程中产生的异常")]),t._v(" "),a("li",[a("RouterLink",{attrs:{to:"/guide/request-handler.html#统一错误处理"}},[t._v("Handler统一错误处理")]),t._v("执行过程中产生的异常")],1)])]),t._v(" "),a("p",[t._v("默认的"),a("strong",[t._v("错误拦截器")]),t._v("将直接向客户端返回500状态码（即：执行"),a("code",[t._v("res.status(500).end()")]),t._v("），"),a("strong",[t._v("我们可以通过修改ServiceCore的实例属性"),a("code",[t._v("errorIntercaptor")]),t._v("以对错误拦截器逻辑进行定制。")])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[a("strong",[t._v("ServiceCore实例仅允许在处于关闭状态时变更其"),a("code",[t._v("errorIntercaptor")]),t._v("属性。")])]),t._v(" "),a("p",[t._v("另外，"),a("strong",[t._v("ServiceCore")]),t._v("将自动包装"),a("strong",[t._v("错误拦截器")]),t._v("为"),a("strong",[t._v("Express标准错误中间件")]),t._v("。因此，我们在设置"),a("strong",[t._v("错误拦截器")]),t._v("时，函数签名按需指定即可，"),a("strong",[t._v("无需严格保持"),a("code",[t._v("(error, req, res, next)")]),t._v("。")])])]),t._v(" "),a("p",[a("strong",[t._v("ServiceCore")]),t._v("的实例属性"),a("code",[t._v("errorIntercaptor")]),t._v("应"),a("strong",[t._v("根据错误拦截器内实际逻辑的同步或异步使用"),a("code",[t._v("Function")]),t._v("或"),a("code",[t._v("AsyncFunction")])]),t._v("，其参数列表依次为：")]),t._v(" "),a("ul",[a("li",[a("strong",[a("code",[t._v("error")])]),t._v("：未被捕获的异常。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("req")])]),t._v("：客户端请求实例。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("res")])]),t._v("：客户端返回实例。")]),t._v(" "),a("li",[a("strong",[a("code",[t._v("next")])]),t._v("：Express中间件流程控制函数，使用方式可以参考"),a("a",{attrs:{href:"https://expressjs.com/en/guide/error-handling.html#error-handling",target:"_blank",rel:"noopener noreferrer"}},[t._v("Express官方文档"),a("OutboundLink")],1),t._v("中对于"),a("code",[t._v("next()")]),t._v("的描述。")])]),t._v(" "),a("p",[a("strong",[t._v("在错误拦截器中不包含异步逻辑时，我们通常指定为"),a("code",[t._v("Function")]),t._v("类型：")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定同步错误拦截器")]),t._v("\nserviceCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("errorIntercaptor")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行错误拦截器逻辑")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[a("strong",[t._v("当错误拦截器中包含异步逻辑时，推荐指定为"),a("code",[t._v("AsyncFunction")]),t._v("类型以使用"),a("code",[t._v("await")]),t._v("指令进行异步操作：")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定异步全局拦截器")]),t._v("\nserviceCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("globalIntercaptor")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行全局拦截器逻辑")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("hr"),t._v(" "),a("p",[t._v("当然，"),a("strong",[t._v("错误拦截器的执行过程中也可能产生异常，默认将触发Express的异常处理逻辑。")])]),t._v(" "),a("p",[t._v("对于此类异常，我们通常在自定义"),a("a",{attrs:{href:"#%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"}},[t._v("构建过程")]),t._v("时向"),a("strong",[t._v("Express实例")]),t._v("中注入兜底"),a("strong",[t._v("Express错误处理中间件")]),t._v("：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" serviceCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serviceCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" nativeCreateServer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" serviceCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_createServer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nserviceCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("createServer")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" configs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callBack")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注入兜底错误处理中间件(逻辑应保持简单以降低异常产生概率)")]),t._v("\n  app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("nativeCreateServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" configs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callBack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("h2",{attrs:{id:"日志收集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志收集"}},[t._v("#")]),t._v(" 日志收集")]),t._v(" "),a("p",[t._v("我们可以通过"),a("strong",[t._v("ServiceCore")]),t._v("的实例属性"),a("code",[t._v("logger")]),t._v("指定其使用的"),a("strong",[t._v("日志收集工具")]),t._v("。在内部实现上，"),a("strong",[t._v("ServiceCore")]),t._v("将调用"),a("code",[t._v("this.logger.log(level, funcName, message)")]),t._v("输出其内部运行日志。")]),t._v(" "),a("p",[t._v("通常，我们使用Corejs内置的"),a("RouterLink",{attrs:{to:"/guide/logger-introduce.html#日期输出器"}},[t._v("日期输出器")]),t._v("作为"),a("strong",[t._v("ServiceCore")]),t._v("的"),a("strong",[t._v("日志收集工具")]),t._v("：")],1),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" serviceCore "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServiceCore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 指定ServiceCore使用DateLogger进行日志收集")]),t._v("\nserviceCore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("logger "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DateLogger")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" filePrefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ServiceCore'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("Corejs内置的"),a("strong",[t._v("日期输出器")]),t._v("将同一日期周期内产生的日志归档至一个文件（组），且支持自动清理和文件分割。")])]),t._v(" "),a("hr"),t._v(" "),a("p",[a("strong",[t._v("ServiceCore内部运行日志的输出等级、方法名和文案存储在"),a("code",[t._v("Core.Macros")]),t._v("和"),a("code",[t._v("Core.Messages")]),t._v("中，我们可以通过提前修改这些宏变量的方式实现日志内容定制（比如：日志国际化）。")])]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("level")]),t._v("：日志输出等级")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("日志输出等级存储在"),a("code",[t._v("Core.Macros")]),t._v("中。")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("宏名称")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("描述")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("默认值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_INFOS_LOG_LEVEL")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("信息日志等级")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("'infos'")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_WARNS_LOG_LEVEL")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("警告日志等级")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("'warns'")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_ERROR_LOG_LEVEL")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("错误日志等级")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("'error'")])])])])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("funcName")]),t._v("：调用方法名")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("调用方法名存储在"),a("code",[t._v("Core.Messages")]),t._v("中。")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("宏名称")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("默认值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_FUNCNAME_LOG")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("'服务核心'")])])])])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("message")]),t._v("：日志文案内容")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("日志文案内容存储在"),a("code",[t._v("Core.Messages")]),t._v("中。")]),t._v(" "),a("p",[t._v("定制日志文案内容时可以使用"),a("code",[t._v("${VAR_NAME}")]),t._v("的形式引用"),a("strong",[t._v("内置变量名")]),t._v("以获取特征信息。")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("比如：我们可以使用"),a("code",[t._v("'当前状态下无法执行操作:[${funcName}]'")]),t._v("引用内置变量名为"),a("code",[t._v("'funcName'")]),t._v("中的信息。")])])])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("宏名称")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("描述")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("内置变量名")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("输出等级")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_MESSAGE_INVALID_STATE")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("当前状态下不允许执行操作")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("funcName")]),t._v("：操作方法名")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_WARNS_LOG_LEVEL")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_MESSAGE_INVALID_HANDLER")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("待绑定的Handler类型无效")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("index")]),t._v("：Handler位于绑定列表的索引")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_WARNS_LOG_LEVEL")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_MESSAGE_INVALID_ROUTE_PATH")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("待绑定的Handler请求路径无效")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("routePath")]),t._v("：Handler的请求路径")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_WARNS_LOG_LEVEL")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_MESSAGE_INVALID_PARAM_TYPE")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("设置全局拦截器/错误拦截器/构建过程时参数无效")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("无")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("抛出异常，不产生日志")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_MESSAGE_SUCCESS_BIND_HANDLER")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("成功绑定Handler")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("routePath")]),t._v("：Handler的请求路径")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_INFOS_LOG_LEVEL")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_MESSAGE_SUCCESS_START_SERVER")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ServiceCore启动成功")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("serverType")]),t._v("：ServiceCore的服务类型；"),a("code",[t._v("baseRoutePath")]),t._v("：基础请求路径")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_INFOS_LOG_LEVEL")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_MESSAGE_FAILURE_START_SERVER")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("ServiceCore启动失败")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("error")]),t._v("：启动失败的原因")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("SERVICE_CORE_ERROR_LOG_LEVEL")])])])])])])])])}),[],!1,null,null,null);s.default=e.exports}}]);